(function(a){function e(c,d){if(c){var e=c.split(b.pathSeparator()),f=d;for(var g=0;g<e.length;g++)if(e[g]===b.upALevel())e.splice(Math.max(g-1,0),2),g--;else{if(typeof f[e[g]]!="object"){if(f[e[g]]===a){f=a;break}f=f[e[g]];break}f=f[e[g]]}return f}}function f(a,c,d){var e=a.split(b.pathSeparator()),f=d,g;for(g=0;g<e.length;g++)e[g]===b.upALevel()&&(e.splice(Math.max(g-1,0),2),g--);for(g=0;g<e.length;g++)typeof f[e[g]]!="object"&&g<e.length-1?isNaN(e[g+1])?(f[e[g]]={},f=f[e[g]]):(f[e[g]]=[],f=f[e[g]]):g===e.length-1?(f[e[g]]=c,isNaN(f.length)||$(b.model).trigger("change."+e.slice(0,e.length-2).join("."))):f=f[e[g]];for(g=0;g<e.length;g++)$(b.model).trigger(["change"].concat(e.slice(0,g+1)).join("_"));$(b.model).trigger("change."+e.join("."))}function g(c,d){setTimeout(function(){if(c.isArray&&!c.isRendered)d.append(c.join("")),c.isRendered=!0;else if(b.views[c.type]!==a){var e=b.views[c.type].render(c);d&&d[0].appendChild(e[0]);for(var f in c.views)for(var i=0;i<c.views[f].length;i++)g(c.views[f][i],c.viewContainers[f].element);if(c.actions)for(var j in c.actions){var k=c.actions[j];c.renderedElement.bind(j,function(){for(var a=0;a<k.length;a++)h(k[a],c)})}}},0)}function h(c,d){for(var e in c.bindings)c.bindings[e]&&c.bindings[e].binding!==a&&(c.bindings[e].binding=b.paths.getAbsolutePath(d.binding,c.bindings[e].binding));typeof b.actions[c.type]=="function"&&b.actions[c.type](c)}function i(c,d,e){if(b.views[c.type]===a)return;$.extend(!0,c,$.extend(!0,{},b.views[c.type].defaults,c));var f="";d&&(f=d.binding,e!==a&&!isNaN(e)&&(f+=b.pathSeparator()+e)),d?c.binding=b.paths.getAbsolutePath(f,c.binding):c.binding=f;for(var g in c.properties)d&&c.properties[g]&&c.properties[g].binding&&(c.properties[g].binding=b.paths.getAbsolutePath(f,c.properties[g].binding),function(a){c.properties[a].binding&&(c.properties[a].value=b.model.get(c.properties[a].binding),$(b.model).bind(["change"].concat(c.properties[a].binding.split(b.pathSeparator())).join("."),function(){b.views[c.type].update[a](c,b.model.get(c.properties[a].binding))}))}(g));for(var g in c.views)for(var h=0;h<c.views[g].length;h++)i(c.views[g][h],c)}function j(){function h(){}return h.prototype={paths:{getAbsolutePath:function(a,b){return b.indexOf(window.gaffa.relativePath())===0?(b=b.replace(window.gaffa.relativePath(),""),b===""?a:a+window.gaffa.pathSeparator()+b):b}},model:{get:function(a){return e(a,c)},set:function(a,b){return f(a,b,c)},update:function(a,b){}},views:{renderTarget:null,render:function(a,b){if(a&&a.length)for(var c=0;c<a.length;c++)g(a[c],b);else if(a)g(a,b);else for(var c=0;c<d.length;c++)g(d[c],this.renderTarget||$("body"))},add:function(c,e,f,g){c&&!c.length&&(c=[c]);for(var h=0;h<c.length;h++)b.views[c[h].type]!==a&&(e&&f?(i(c[h],e,g),f.push(c[h])):(i(c[h]),d.push(c[h])))},base:function(a,c,d){return{render:function(b){if(b.renderedElement)return b.renderedElement;$.extend(!0,b,d,b),b.renderedElement=c(b),b.renderedElement[0].viewModel=b;for(var e in b.properties){var f=window.gaffa.views[a].update[e];f&&typeof f=="function"&&f(b,b.properties[e].value,!0)}return b.renderedElement},update:{visible:function(a,b,c){if(a.properties.visible.value!==b||c){a.properties.visible.value=b;var d=a.renderedElement;d&&(b!==!1?d.show():d.hide())}},classes:function(a,b,c){if(a.properties.classes.value!==b||c){var d=a.renderedElement;d&&(a.properties.classes.value&&d.removeClass(a.properties.classes.value),d.addClass(a.properties.classes.value=b))}}},defaults:{binding:b.relativePath(),properties:{visible:{},classes:{}}}}}},actions:{},behaviours:{add:function(c){c&&!c.length&&(c=[c]);for(var d=0;d<c.length;d++){var e=c[d].type;e==="pageLoad"?function(c){$(document).ready(function(){for(var d=0;d<c.actions.length;d++)b.actions[c.actions[d].type]!==a&&b.actions[c.actions[d].type](c.actions[d])})}(c[d]):e==="modelChange"&&function(c){$(b.model).bind(["change"].concat(c.binding.split("/")).join("_"),function(){for(var d=0;d<c.actions.length;d++)b.actions[c.actions[d].type]!==a&&b.actions[c.actions[d].type](c.actions[d])})}(c[d])}}},utils:{propExists:function(b,c){var d=c.split(".").reverse();while(d.length){var e=d.pop();if(b[e]===a)return!1;b=b[e]}return!0}}},new h}var b=window.gaffa=window.gaffa||j();b.pathSeparator=function(){return"/"},b.upALevel=function(){return".."},b.relativePath=function(){return"~"};var c={},d=[];Array.prototype.isArray=!0})();