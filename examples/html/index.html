<html>
    <head>
        <link href="css/site.css" media="screen" rel="stylesheet" type="text/css">
        <link href="css/accordion.css" media="screen" rel="stylesheet" type="text/css">
        <link href="css/grid.css" media="screen" rel="stylesheet" type="text/css">
        <link href="css/code.css" media="screen" rel="stylesheet" type="text/css">
        <link href="css/intro.css" media="screen" rel="stylesheet" type="text/css">
        
        <script src="scripts/jquery-1.7.1.min.js" type="text/javascript"></script>

        <!-- the tape -->
        <script src="scripts/gaffa.js" type="text/javascript"></script>
        <script src="scripts/actions.js" type="text/javascript"></script>
        <script src="scripts/views.js" type="text/javascript"></script>
        
        <!-- the application -->
        <script type="text/javascript">
        
            /* page model */
            gaffa.model.set("viewStrings",{
                showHideViewData: '{"type":"container","properties":{"classes":{"value":"span12"}},"views":{"content":[{"type":"heading","properties":{"text":{"binding":"main/thirdHeading"}}},{"type":"paragraph","views":{"content":[["It is a \""],{"type":"text","properties":{"text":{"binding":"main/thirdHeading"}}},["\", though the implications might not be obvious straight away.<br /><br />Check out this next bit of form:"]]}},{"type":"paragraph","views":{"content":[{"type":"form","views":{"content":[{"type":"textbox","properties":{"value":{"binding":"main/thirdHeading"}},"actions":{"change":[{"type":"set","bindings":{"setTo":{"binding":"main/show4thContainer"},"setFrom":{"value":true}}},{"type":"set","bindings":{"setTo":{"binding":"main/show5thContainer"},"setFrom":{"value":true}}}]}},{"type":"button","properties":{"text":{"value":"Change the text for me (I\'m lazy)"}},"actions":{"click":[{"type":"set","bindings":{"setTo":{"binding":"main/thirdHeading"},"setFrom":{"value":"Hello world..."}}},{"type":"set","bindings":{"setTo":{"binding":"main/show4thContainer"},"setFrom":{"value":true}}},{"type":"set","bindings":{"setTo":{"binding":"main/show5thContainer"},"setFrom":{"value":true}}}]}}]}}]}},{"type":"paragraph","views":{"content":[["<b>Change the value of the textbox (and then tab out to trigger the changed event)</b>"]]}}]}}',
                listViewData: '{"type":"list","binding":"main/anArray","properties":{"list":{"template":{"type":"textbox","properties":{"value":{"binding":"~"}}},"binding":"main/anArray"}}}' 
            });
            
            gaffa.model.set("main", {
                show4thContainer: false,
                show5thContainer: false,
                someBool: true,
                someOtherBool: false,
                someProperty: "a heading",
                thirdHeading: "A Cool story bro...",
                anArray: [
                    "value1",
                    "value2",
                    "value3"
                ],
                radioOptions: [
                    {value: "option1", label: "option 1"},
                    {value: "option2", label: "option 2"},
                    {value: "option3", label: "option 3"}
                ],
                gridData: {
                    columns: [
                        "col1","col2","col3","col4","col5","col6","col7","col8","col9","col10","col11","col12","col13","col14"
                    ],
                    rows: [
                        { 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        }
                    ]
                }
            });
            
            gaffa.model.set("original", {
                show4thContainer: false,
                show5thContainer: false,
                someBool: true,
                someOtherBool: false,
                someProperty: "a heading",
                thirdHeading: "Cool story bro...",
                anArray: [
                    "value1",
                    "value2",
                    "value3"
                ],
                radioOptions: [
                    {value: "option1", label: "option 1"},
                    {value: "option2", label: "option 2"},
                    {value: "option3", label: "option 3"}
                ],
                gridData: {
                    columns: [
                        "col1","col2","col3","col4","col5","col6","col7","col8","col9","col10","col11","col12","col13","col14"
                    ],
                    rows: [
                        { 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        },{ 
                            columns: ["data","data","data","data","data","data","data","data","data","data","data","data","data","data"]                          
                        }
                    ]
                }
            });
            
            gaffa.behaviours.add([
                {
                    binding: "main",
                    type: "modelChange",
                    actions: [
                        {
                            type: "toJson",
                            bindings: {
                                setFrom: { binding: "main" },
                                setTo: { binding: "things" }
                            }
                        }
                    ]
                },
                {
                    binding: "main",
                    type: "modelChange",
                    actions: [
                        {
                            type: "store",
                            storeType: "localStorage",
                            storageKey: "mainModel",
                            bindings: {
                                setFrom: { binding: "main" }
                            }
                        },
                        {
                            type: "store",
                            storeType: "localStorage",
                            storageKey: "thingsModel",
                            bindings: {
                                setFrom: { binding: "things" }
                            }
                        },
                        {
                            type: "store",
                            storeType: "localStorage",
                            storageKey: "viewStringsModel",
                            bindings: {
                                setFrom: { binding: "viewStrings" }
                            }
                        }
                    ]
                },
                {
                    binding: "main",
                    type: "pageLoad",
                    actions: [
                        {
                            type: "fetch",
                            location: "local",
                            path: "mainModel",
                            bindings: {
                                setTo: { binding: "main" }
                            }
                        },
                        {
                            type: "fetch",
                            location: "local",
                            path: "thingsModel",
                            bindings: {
                                setTo: { binding: "things" }
                            }
                        },
                        {
                            type: "fetch",
                            location: "local",
                            path: "viewStringsModel",
                            bindings: {
                                setTo: { binding: "viewStrings" }
                            }
                        },
                        {
                            type: "fetch",
                            location: "server",
                            path: "/index",
                            bindings: {
                                setTo: { binding: "viewStrings" }
                            }
                        } 
                    ]
                } 
            ]);
            
            /* page view */
            /*
            
                NOTE: This is absolutely NOT the standard way of creating a page, this object would usually be generated from the server.
            
            */
            gaffa.views.add([
                {
                    type: "nav",
                    properties: {
                        text: { value: "gaffa.js" },
                        fixed: { value: true }
                    }
                },
                {
                    type: "container",
                    properties: {
                        classes: { value: "container"}    
                    },
                    views: {
                        content: [
                        {
                            type: "container",
                            properties: {
                                classes: { value: "row" }
                            },
                            views: {
                                content: [
                                    {
                                        type: "container",  
                                        properties: {
                                            classes: { value: "span12" }
                                        },
                                        views: {
                                            content: [
                                                {
                                                    type: "heading",
                                                    properties: {
                                                        text: { value: "What is Gaffa?" }
                                                    }
                                                },
                                                {
                                                    type: "quote",
                                                    properties: {
                                                        text: { value: "Gaffer tape, gaffer's tape, gaff tape[1] or gaffa tape[2] is a strong, tough, cotton cloth pressure sensitive tape with strong adhesive properties." },
                                                        cite: { value: "Wikipedia" },
                                                        citeHref: { value: "http://en.wikipedia.org/wiki/Gaffer_tape" },
                                                        classes: { binding: "main/someProperty" }
                                                        //alignment: { value: "right" }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            }
                        },
                        {
                            type: "container",
                            properties: {
                                classes: { value: "row" }
                            },
                            views: {
                                content: [
                                    {
                                        type: "container",  
                                        properties: {
                                            classes: { value: "span12" }
                                        },
                                        views: {
                                            content: [
                                                {
                                                    type: "heading",
                                                    properties: {
                                                        text: { value: "But seriously..." }
                                                    }
                                                },
                                                ["<b>gaffa.js</b> sticks your DOM to your models. More specifically, it lets you set a model to any javascript object, and bind your page's views to properties on it, using paths."],
                                                {
                                                    type:"paragraph",
                                                    views:{
                                                        content:[
                                                            {
                                                                type: "text",
                                                                properties: {
                                                                    text: { value: "100% of all the things are JSON, the page is made up of JSON 'views'" }
                                                                }
                                                            }
                                                        ]
                                                    }
                                                },
                                                {
                                                    type:"paragraph",
                                                    views:{
                                                        content:[
                                                            {
                                                                type: "text",
                                                                properties: {
                                                                    text: { value: "And everything is a View, so create your own or use community provided bundles." }
                                                                }
                                                            }
                                                        ]
                                                    }
                                                }
                                            ]
                                        }
                                    },
                                    {
                                        type: "container",  
                                        properties: {
                                            classes: { value: "span12" }
                                        },
                                        views: {
                                            content: [
                                                {
                                                    type: "heading",
                                                    properties: {
                                                        text: { binding: "main/thirdHeading" }
                                                    }
                                                },
                                                {
                                                    type:"paragraph",
                                                    views:{
                                                        content: [
                                                            ["It is a \""],
                                                            {
                                                                type:"text",
                                                                properties: {
                                                                    text: {binding:"main/thirdHeading"}
                                                                }
                                                            },
                                                            ["\", though the implications might not be obvious straight away.<br /><br />Check out this next bit of form:"]
                                                        ]
                                                    }
                                                },
                                                {
                                                    type:"paragraph",
                                                    views:{
                                                        content:[
                                                            {
                                                                type:"form",
                                                                views:{
                                                                    content:[
                                                                        {
                                                                            type:"textbox",
                                                                            properties: {
                                                                                value: {binding:"main/thirdHeading"}
                                                                            },
                                                                            actions:{
                                                                                change:[
                                                                                    {
                                                                                        type: "set",
                                                                                        bindings: {
                                                                                            setTo: { binding: "main/show4thContainer"},
                                                                                            setFrom: { value: true}
                                                                                        }
                                                                                    },
                                                                                    {
                                                                                        type: "set",
                                                                                        bindings: {
                                                                                            setTo: { binding: "main/show5thContainer"},
                                                                                            setFrom: { value: true}
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        },
                                                                        {
                                                                            type:"button",
                                                                            properties: {
                                                                                text: {value:"Change the text for me (I'm lazy)"}
                                                                            },
                                                                            actions:{
                                                                                click:[
                                                                                    {
                                                                                        type: "set",
                                                                                        bindings: {
                                                                                            setTo: { binding: "main/thirdHeading"},
                                                                                            setFrom: { value: "Hello world..."}
                                                                                        }
                                                                                    },
                                                                                    {
                                                                                        type: "set",
                                                                                        bindings: {
                                                                                            setTo: { binding: "main/show4thContainer"},
                                                                                            setFrom: { value: true}
                                                                                        }
                                                                                    },
                                                                                    {
                                                                                        type: "set",
                                                                                        bindings: {
                                                                                            setTo: { binding: "main/show5thContainer"},
                                                                                            setFrom: { value: true}
                                                                                        }
                                                                                    }
                                                                                ]
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }
                                                        ]
                                                    }
                                                },
                                                {
                                                    type:"paragraph",
                                                    views:{
                                                        content: [
                                                            ["<b>Change the value of the textbox (and then tab out to trigger the changed event)</b>"]
                                                        ]
                                                    }
                                                },
                                                {
                                                    type:"button",
                                                    properties: {
                                                        text: {value:"Show Popup"}
                                                    },
                                                    actions:{
                                                        click:[
                                                            {
                                                                type: "popView",
                                                                bindings: {
                                                                    setTo: { binding: "main/thirdHeading"},
                                                                    setFrom: { value: "Hello world..."}
                                                                }
                                                            }
                                                        ]
                                                    }
                                                }

                                            ]
                                        }
                                    },
                                    {
                                        type:"code",
                                        properties: {
                                            code: { binding: "viewStrings/showHideViewData" }
                                        }
                                    },
                                    {
                                        type: "container",  
                                        properties: {
                                            classes: { value: "span12" },
                                            visible: { binding: "main/show4thContainer"}
                                        },
                                        views: {
                                            content: [
                                                {
                                                    type: "heading",
                                                    properties: {
                                                        text: { value: "Kewl!" }
                                                    }
                                                },
                                                {
                                                    type:"paragraph",
                                                    views:{
                                                        content: [
                                                            ["The textbox above, the H1 above it, and some text in between the two are ",
                                                            "all bound to the same property on the model, changing the text in the textbox ",
                                                            "updates the model, which tells all things bound to it to update too.<br /><br />",
                                                            "There is also an action bound to the change event on the textbox, that sets a property in the model to true. ",
                                                            "This containers visibility is bound to that same property<br /><br />",
                                                            "This button sets that same property to false: "],
                                                            { 
                                                                type: "button",
                                                                properties: {
                                                                    text: { value: "Hide this container" }
                                                                },
                                                                actions:{
                                                                    click:[
                                                                        {
                                                                            type: "set",
                                                                            bindings: {
                                                                                setTo: { binding: "main/show4thContainer"},
                                                                                setFrom: { value: false}
                                                                            }
                                                                        }   
                                                                    ]
                                                                }                                                          
                                                            }
                                                        ]
                                                    }
                                                }
                                            ]
                                        }
                                    },
                                    {
                                        type: "container",  
                                        properties: {
                                            classes: { value: "span12" },
                                            visible: { binding: "main/show5thContainer"}
                                        },
                                        views: {
                                            content: [
                                                {
                                                    type: "heading",
                                                    properties: {
                                                        text: { value: "Other main" }
                                                    }
                                                },
                                                ["Gaffa can be used to easily template views based on an array. <br /><br />Here is a simple example that uses textboxes as a template. The textbox's value properties are bound to '~' (relative), so they reflect the data in the array.<br />"],
                                                {
                                                    type:"button",
                                                    properties: {
                                                        text: {value:"Add an array element"}
                                                    },
                                                    actions:{
                                                        click:[
                                                            {
                                                                type: "push",
                                                                bindings: {
                                                                    pushTo: { binding: "main/anArray"},
                                                                    pushFrom: { value: ""}
                                                                }
                                                            }
                                                        ]
                                                    }
                                                },
                                                {
                                                    type: "list",
                                                    binding: "main/anArray",
                                                    properties:
                                                    {
                                                        list:{
                                                            template: {
                                                                type: "textbox",
                                                                properties: {
                                                                    value: { binding: "~"}
                                                                }
                                                            },
                                                            binding: "main/anArray"
                                                        }
                                                    }
                                                },
                                                {
                                                    type:"code",
                                                    properties: {
                                                        code: { binding: "viewStrings/listViewData" }
                                                    }
                                                },
                                                ["You can also bind a list to an array, provide a template view, and let it do the rest. "],
                                                ["All templated views will be bound just as any pre-existing views would."],
                                                ["<br /><br /><b>This textarea contains a JSONified version of the model, and yes, it is bound. Changing it's content will change the pages model, and vice-verse.</b>"],
                                                {
                                                    type: "textarea",
                                                    properties: {
                                                        value: { binding: "things/jsonmain"},
                                                        classes: { value:"span12" }
                                                    },
                                                    actions: {
                                                        change:[
                                                            {
                                                                type: "fromJson",
                                                                bindings: {
                                                                    setFrom: { binding: "things/jsonmain" },
                                                                    setTo: { binding: "main" }
                                                                }
                                                            }
                                                        ]
                                                    }
                                                },
                                                {
                                                    type: "heading",
                                                    properties: {
                                                        text: { value: "A Little more complex" }
                                                    }
                                                },
                                                ["<br /><br />A simple accordian control:"],
                                                {
                                                    type: "accordion",
                                                    binding: "main/anArray",
                                                    properties:
                                                    {
                                                        list: { 
                                                            binding:"main/anArray",
                                                            template: {
                                                                type:"accordionNode",
                                                                views: {
                                                                    content: [
                                                                        ["Some accordon node content, say, a data-bound textbox? "],
                                                                        {
                                                                            type: "textbox",
                                                                            properties: {
                                                                                value: { binding: "~"}
                                                                            }
                                                                        }
                                                                    ],
                                                                    header:[
                                                                        {
                                                                            type: "text",
                                                                            properties: {
                                                                                text: { binding: "~"}
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            }                                                            
                                                        }
                                                    }
                                                },
                                                ["A less simple accordian control: <b>CAUTION!!! the number of accordion nodes created in this example is the number of array elements in the array cubed. So if you add 20 array elements, this will create 8000 accordion nodes.</b>"],
                                                {
                                                    type: "accordion",
                                                    binding: "main/anArray",
                                                    properties:
                                                    {
                                                        list: { 
                                                            binding:"main/anArray",
                                                            template: {
                                                                type:"accordionNode",
                                                                views: {
                                                                    content: [
                                                                        {
                                                                            type: "accordion",
                                                                            binding: "main/anArray",
                                                                            properties:
                                                                            {
                                                                                list: { 
                                                                                    binding:"main/anArray",
                                                                                    template: {
                                                                                        type:"accordionNode",
                                                                                        views: {
                                                                                            content: [
                                                                                                {
                                                                                                    type: "accordion",
                                                                                                    binding: "main/anArray",
                                                                                                    properties:
                                                                                                    {
                                                                                                        list: { 
                                                                                                            binding:"main/anArray",
                                                                                                            template: {
                                                                                                                type:"accordionNode",
                                                                                                                views: {
                                                                                                                    content: [
                                                                                                                        ["Some accordion node content, say, a data-bound textbox? "],
                                                                                                                        {
                                                                                                                            type: "textbox",
                                                                                                                            properties: {
                                                                                                                                value: { binding: "~"}
                                                                                                                            }
                                                                                                                        }
                                                                                                                    ],
                                                                                                                    header:[
                                                                                                                        ["Accordion-ception-ception-ception"]
                                                                                                                    ]
                                                                                                                }
                                                                                                            }                                                            
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            ],
                                                                                            header:[
                                                                                                ["Accordion-ception-ception"]
                                                                                            ]
                                                                                        }
                                                                                    }                                                            
                                                                                }
                                                                            }
                                                                        }
                                                                    ],
                                                                    header:[
                                                                        ["Accordion-ception"]
                                                                    ]
                                                                }
                                                            }                                                            
                                                        }
                                                    }
                                                },
                                                ["<br /><br />The ease at which complex things can be created is sometimes silly.<br /><br />",
                                                "A (very) simple editable grid:<br />"],
                                                {
                                                    type: "list",
                                                    binding: "main/gridData/columns",
                                                    properties:
                                                    {
                                                        list:{
                                                            template: {
                                                                type: "text",
                                                                properties: {
                                                                    text: { binding: "~"},
                                                                    classes: { value: "cell" }
                                                                }
                                                            },
                                                            binding: "main/gridData/columns"
                                                        },
                                                        classes: { value: "header" }
                                                    }
                                                },
                                                {
                                                    type: "list",
                                                    binding: "main/gridData/rows",
                                                    properties:
                                                    {
                                                        list:{
                                                            template: {
                                                                type: "container",
                                                                views: {
                                                                    content:[
                                                                        {
                                                                            type: "list",
                                                                            binding: "~columns",
                                                                            properties:
                                                                            {
                                                                                list:{
                                                                                    template: {
                                                                                        type: "textbox",
                                                                                        properties: {
                                                                                            value: { binding: "~"},
                                                                                            classes: { value: "cell" }
                                                                                        }
                                                                                    },
                                                                                    binding: "~columns"
                                                                                }
                                                                            }
                                                                        }
                                                                    ]
                                                                },
                                                                properties:{
                                                                    classes: { value: "row" }
                                                                }
                                                            },
                                                            binding: "main/gridData/rows"
                                                        },
                                                        classes: { value: "grid" }
                                                    }
                                                },
                                                {
                                                    type: "container",
                                                    views: {
                                                        content: [
                                                            ["Your data has been saved to local storage, click here to reset the page: "],
                                                            { 
                                                                type: "button",
                                                                properties: {
                                                                    text: { value: "Clear my data from local storage" }
                                                                },
                                                                actions:{
                                                                    click:[
                                                                        {
                                                                            type: "store",
                                                                            storeType: "localStorage",
                                                                            storageKey: "mainModel",
                                                                            bindings: {
                                                                                setFrom: { value: null }
                                                                            }
                                                                        },
                                                                        {
                                                                            type: "store",
                                                                            storeType: "localStorage",
                                                                            storageKey: "thingsModel",
                                                                            bindings: {
                                                                                setFrom: { value: null }
                                                                            }
                                                                        },
                                                                        {
                                                                            type: "store",
                                                                            storeType: "localStorage",
                                                                            storageKey: "viewStringsModel",
                                                                            bindings: {
                                                                                setFrom: { value: null }
                                                                            }
                                                                        },
                                                                        {
                                                                            type: "set",
                                                                            bindings: {
                                                                                setFrom: { binding: "original" },
                                                                                setTo: { binding: "main" }
                                                                            }
                                                                        } 
                                                                    ]
                                                                }                                                          
                                                            }
                                                        ]
                                                    }
                                                },
                                                ["<br />"],
                                                {
                                                    type: "list",
                                                    binding: "main/radioOptions",
                                                    properties:{
                                                        list: {
                                                            binding: "main/radioOptions",
                                                            template: {
                                                                type:"radioOption",
                                                                properties: {
                                                                    text: { binding: "~label" },
                                                                    value: { binding: "~value" },
                                                                    name: { value: "radioGroup" },
                                                                    checked: { binding: "main/checkedRadioOption" }
                                                                }
                                                            }
                                                        }
                                                    }                                                   
                                                },
                                                ["<br />"],
                                                {
                                                    type: "select",
                                                    binding: "main/radioOptions",
                                                    properties:{
                                                        options: { 
                                                            binding: "main/radioOptions",
                                                            textBinding: "~label",
                                                            valueBinding: "~value"
                                                        },
                                                        value: { binding: "main/checkedRadioOption" }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            }
                        }
                    ]
                }
            }]);

            /* Webpage++ */
            $(document).ready(function(){
                gaffa.views.renderTarget = $("body");
                gaffa.views.render();
            });
        
        </script>
        <style>
            body > .container{
                margin-top:40px;    
            }
            
            form{
                background: #aaa;
                padding:10px;
                border-radius: 5px;
            }
        </style>
    </head>
    <body>
    </body>
</html>